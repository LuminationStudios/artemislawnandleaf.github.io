<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Artemis Lawn & Leaf</title>
  <meta name="description" content="Artemis Lawn & Leaf â€” affordable seasonal yard care and cleanup options" /> 
  <link rel="icon" href="logo/leaficon.svg" type="image/svg+xml">

  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="index.css">
  <script src="calendarnav.js" defer></script>
</head>
<body>
  <!-- ðŸŒ¿ Header -->
  <header class="sticky-header">
    <div class="header-inner container">
      <div class="brand">
        <div class="logo">
          <img src="logo/leaficon.svg" alt="Logo" width="36" height="36">
        </div>
        <strong>Artemis Lawn & Leaf</strong>
      </div>
      <nav class="nav-links" id="navLinks"></nav>
    </div>
  </header>

<h1 style="text-align:center;">Admin Calendar</h1>
<div id="calendar-container">
  <div id="calendar-nav">
    <button id="prevMonth">&lt; Previous</button>
    <h2 id="monthYear"></h2>
    <button id="nextMonth">Next &gt;</button>
  </div>

  <div class="weekdays">
    <div class="weekday">Sun</div>
    <div class="weekday">Mon</div>
    <div class="weekday">Tue</div>
    <div class="weekday">Wed</div>
    <div class="weekday">Thu</div>
    <div class="weekday">Fri</div>
    <div class="weekday">Sat</div>
  </div>

  <div id="calendar"></div>

  <button class="export-btn" id="exportICS">Export .ICS</button>
  <button class="export-btn" id="saveJSON" style="background:#43a047;">Save to Server</button>
</div>

<!-- Event Modal -->
<div id="eventModal">
  <div class="modal-content">
    <button class="close-btn" id="closeModal">X</button>
    <h3 id="modalDate"></h3>
    <div id="modalEvents"></div>
    <hr>
    <input type="text" id="eventTitle" placeholder="Event Title">
    <input type="date" id="eventDate">
    <input type="time" id="eventTime">
    <select id="eventType">
      <option value="Leaf Cleanup">Leaf Cleanup</option>
      <option value="Snow Removal">Snow Removal</option>
      <option value="Closed">Closed</option>
      <option value="Other">Other</option>
    </select>
    <button class="save-btn" id="addEvent">Add Event</button>
  </div>
</div>

  <!-- ðŸŒ¼ Footer -->
  <footer></footer>

<script>
const PASSWORD = 'artielawn2025'; // Admin password

// Elements
const loginModal = document.getElementById('loginModal');
const loginBtn = document.getElementById('loginBtn');
const loginPassword = document.getElementById('loginPassword');
const calendarContainer = document.getElementById('calendar-container');

const calendarDiv = document.getElementById('calendar');
const monthYearHeader = document.getElementById('monthYear');
const prevBtn = document.getElementById('prevMonth');
const nextBtn = document.getElementById('nextMonth');

const modal = document.getElementById('eventModal');
const modalDate = document.getElementById('modalDate');
const modalEvents = document.getElementById('modalEvents');
const closeModal = document.getElementById('closeModal');

const eventTitle = document.getElementById('eventTitle');
const eventDate = document.getElementById('eventDate');
const eventTime = document.getElementById('eventTime');
const eventType = document.getElementById('eventType');
const addEventBtn = document.getElementById('addEvent');
const exportICSBtn = document.getElementById('exportICS');
const saveJSONBtn = document.getElementById('saveJSON');

let events = JSON.parse(localStorage.getItem('events')) || [];
const typeColors = { "Leaf Cleanup": "#FF8C42", "Snow Removal": "#42A5FF", "Closed": "#db5856", "Other": "#FFD27F" };

let today = new Date();
let currentMonth = today.getMonth();
let currentYear = today.getFullYear();
let selectedDate = null;



// Calendar helpers
function daysInMonth(month, year){ return new Date(year, month+1,0).getDate(); }

function renderCalendar(month,year){
    calendarDiv.innerHTML='';
    monthYearHeader.textContent = new Date(year, month).toLocaleString('default',{ month:'long', year:'numeric' });

    const firstDay = new Date(year,month,1).getDay();
    const totalDays = daysInMonth(month,year);

    for(let i=0;i<firstDay;i++) calendarDiv.appendChild(document.createElement('div'));

    for(let day=1;day<=totalDays;day++){
        const dayDiv=document.createElement('div');
        dayDiv.classList.add('day');

        const dateNumber=document.createElement('div');
        dateNumber.classList.add('date-number');
        dateNumber.textContent=day;
        dayDiv.appendChild(dateNumber);

        const currentDate=new Date(year,month,day);
        const dateStr=currentDate.toISOString().split('T')[0];

        if(currentDate.toDateString()===today.toDateString()) dayDiv.classList.add('today');
        if(currentDate<new Date(today.getFullYear(),today.getMonth(),today.getDate())) dayDiv.classList.add('past');

        const dayEvents = events.filter(ev=>ev.date===dateStr);
        dayEvents.forEach(ev=>{
            const evDiv=document.createElement('span');
            evDiv.classList.add('event');
            evDiv.style.backgroundColor=typeColors[ev.type]||typeColors["Other"];
            evDiv.textContent=ev.title;
            dayDiv.appendChild(evDiv);
        });

        dayDiv.onclick=()=>openModal(dateStr);
        calendarDiv.appendChild(dayDiv);
    }
}

// Modal functions
function openModal(dateStr){
    selectedDate=dateStr;
    modal.style.display='flex';
    modalDate.textContent=new Date(dateStr).toDateString();
    eventDate.value=dateStr;
    eventTitle.value='';
    eventTime.value='';
    eventType.value='Leaf Cleanup';
    renderModalEvents();
}

function renderModalEvents(){
    modalEvents.innerHTML='';
    const dayEvents = events.filter(ev=>ev.date===selectedDate);
    dayEvents.forEach(ev=>{
        const evDiv=document.createElement('div');
        evDiv.classList.add('event-item');
        evDiv.style.backgroundColor=typeColors[ev.type]||typeColors["Other"];
        evDiv.innerHTML=`${ev.time||'All Day'} - ${ev.title} <button class="delete-btn">Delete</button>`;
        evDiv.querySelector('button').onclick=()=>{
            events.splice(events.indexOf(ev),1);
            localStorage.setItem('events',JSON.stringify(events));
            renderCalendar(currentMonth,currentYear);
            renderModalEvents();
        };
        modalEvents.appendChild(evDiv);
    });
}

addEventBtn.onclick=()=>{
    if(!eventTitle.value.trim()) return alert('Enter a title');
    const newEv={ title:eventTitle.value, date:eventDate.value, time:eventTime.value, type:eventType.value };
    events.push(newEv);
    localStorage.setItem('events',JSON.stringify(events));
    renderCalendar(currentMonth,currentYear);
    renderModalEvents();
};

// Navigation
prevBtn.onclick=()=>{ currentMonth--; if(currentMonth<0){currentMonth=11;currentYear--;} renderCalendar(currentMonth,currentYear);}
nextBtn.onclick=()=>{ currentMonth++; if(currentMonth>11){currentMonth=0;currentYear++;} renderCalendar(currentMonth,currentYear);}

closeModal.onclick=()=> modal.style.display='none';
window.onclick=e=>{ if(e.target==modal) modal.style.display='none'; }

// ICS Export (fixed end times)
function generateICS(events){
    let ics=`BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Artemis Lawn & Leaf//EN\n`;
    events.forEach(ev=>{
        const date=ev.date.replace(/-/g,'');
        let startTime='000000';
        let endTime='010000';
        if(ev.time){
            const [h,m]=ev.time.split(':');
            startTime=`${h.padStart(2,'0')}${m.padStart(2,'0')}00`;
            const dateObj = new Date(`${ev.date}T${ev.time}`);
            dateObj.setHours(dateObj.getHours()+1);
            const endH = String(dateObj.getHours()).padStart(2,'0');
            const endM = String(dateObj.getMinutes()).padStart(2,'0');
            endTime = `${endH}${endM}00`;
        }
        ics+=`BEGIN:VEVENT\nSUMMARY:${ev.title}\nDTSTART:${date}T${startTime}\nDTEND:${date}T${endTime}\nCATEGORIES:${ev.type}\nEND:VEVENT\n`;
    });
    ics+='END:VCALENDAR';
    return ics;
}

exportICSBtn.onclick=()=>{
    const blob=new Blob([generateICS(events)],{type:'text/calendar'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download='events.ics';
    link.click();
    URL.revokeObjectURL(link.href);
    alert('âœ… ICS exported!');
};

// Save to server
saveJSONBtn.onclick=async()=>{
    try{
        const res=await fetch('save-json.php',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(events)
        });
        const txt=await res.text();
        alert(txt);
    }catch(err){console.error(err); alert('Error saving JSON');}
};
</script>


</body>
</html>
